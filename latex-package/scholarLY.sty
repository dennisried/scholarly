\ProvidesPackage{scholarLY}

\RequirePackage{verbatim}
\RequirePackage{ifthen}
\RequirePackage{enumitem}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% OPTIONS ... the customizable part of the package
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Some options can be applied by wrapping the \annotations{filename.annotations.inp} in
% respective environment, such as {multicols}, {xcolor}, etc.
%
% If specific changes are made to items with either the \renewcommand options (see Global
% Styling Options below) or otherwise within the text of the actual .inp lists (written
% by the user in the LilyPond document), they will override wrappers as applicable.


% ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~
%% ~ ~ ~ DRAFT or FINAL MODE  ~
% ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~
%
% So far, this only affects horizontal/vertical arrangement. What else?

\newif\ifex@draft % (implicitly final) ... i.e. draft mode if set, otherwise final mode,
                  % which can also be explicitly set: \usepackage[final]{scholarLY}

\DeclareOption{draft}{\ex@drafttrue}
\DeclareOption{final}{\ex@draftfalse}
\ProcessOptions*

\ifex@draft
  \newcommand\skipornot{\par}
\else
  \newcommand\skipornot{, } % TODO: leave empty here, add conditional comma for
\fi                         % each parameter (exist if used; none/empty if not)


% ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~
%% ~ ~ ~ ENUMERATION STYLE: ~
% ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~
%
% This package (currently) uses the 'enumitem' package for listing/formatting
% the annotations. These options can be place at the top of the document (will
% affect the entire document, unless changed) or just before the annotations.
% More info: https://www.ctan.org/pkg/enumerate?lang=en

%%% ONE or TWO PARENS, or other
\renewcommand\labelenumi{\theenumi)}     % This should be easily customizable by
% \renewcommand\labelenumi{(\theenumi)}  % the user. Either recommend in the documentation
                                         % that it can be changed as such, or create an
                                         % abbreviated command for the user.
%%% SPACING
\setlist[enumerate]{leftmargin=*} % left-justified (to each margin)
\setlist{parsep=0pt} % spacing between different annotations
\setlength{\parskip}{0em} % line-spacing within each annotation


% ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~
%% ~ ~ ~ FORMAT FOOTNOTES ~
% ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~

% example: ... NOTE: remove this later, after testing
%
% \musicalIssue \with {
%   message = "This is my message\fnOne, and it has two footnotes."
%   fnOneText = "This is the text of the footnote"
%   annotation-footnote = "This automatically tagged to end of message"
% }

% ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~
%% ~ ~ ~ CONTINUE or RESET FOOTNOTE COUNT ~
% ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~


\newcommand{\lastfootnote}[1]{\setcounter{footnote}{#1}}
\newcommand{\resetfootnotes}{\setcounter{footnote}{0}}
%
\resetfootnotes % default
%
% To manually reset (overriding continuation, if applicable) prepend the
% following to \annotations{filename.annotations.inp} command:
%   \lastfootnote{#}
% To reset the count (at any time):
%   \resetfootnotes


% ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~
%% ~ ~ ~ GLOBAL FORMATTING OPTIONS  ~
% ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~

% TODO MULTI-COLUMNs
% multicols package is applicable
% BUT, make condition to avoid breaking arguments inside an annotation
%
% [twocolumn] option is applicable, but also breaks (allow or avoid?; or optional?)
%
% Also, note these each also break the footnotes; want this? Make optional?


% ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~
%% ~ ~ ~ GLOBAL STYLING OPTIONS ~
% ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~

% DEFAULTS
\newcommand{\annType}[1]{\textit{#1}} % Annotation Type; just italics
\newcommand{\annMeasure}[1]{\textbf{#1}} % just bold
\newcommand{\annBeat}[1]{#1} % none
\newcommand{\annVoice}[1]{#1} % none ; this is Voice or Instrument (e.g. Viola)
\newcommand{\annAffected}[1]{#1} % none
\newcommand{\annMessage}[1]{#1} % none
\newcommand{\annFootnote}[1]{#1} % none

% TODO a cleaner way to write this; and footnote text styling; and other footnote mark styling
\newcommand{\footnotemarkcolor}{red} % abbreviated footnote color command
\makeatletter
\renewcommand{\@makefnmark}{\hbox{\@textsuperscript{%
  \color{\footnotemarkcolor}\normalfont\@thefnmark}}}
\makeatother
%
% temporary INSTRUCTIONS
% to change these, 'renew' the command, such as
%
% \renewcommand{\annType}[1]{#1} % no formatting
% \renewcommand{\annType}[1]{\textbf{#1}} % just bold
% \renewcommand{\annType}[1]{\textit{\textbf{#1}}} % bold and italics
%
% In short, each additional style must be wrapped by (or wrap) the rest.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% ENVIRONMENTS and COMMANDS ... the main part of the package
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% ~ ~ ~ \annotations = the main command ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~

\newcommand{\annotations}[1]{\begin{enumerate}{\input{#1}}\end{enumerate}}

%% ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~

% The LAST parameter in each set is footnote. If empty, one won't be created. If
% other optional parameters are added in the future, these places (#1, #2, etc)
% may shift. Non-defined parameters should always make the list as {}, otherwise
% latex will assume the next argument (whether {} or {argument}) in that place.
%
% Requires annotation type and measure number, all other arguments optional

\newcommand{\criticalRemark}[6]{
  \item{\annType{(Critical Remark)}\skipornot
  {\annMeasure{M.#1,}}}   \ifthenelse{\equal{#2}{}}{}{\annBeat{beat #2}\skipornot}
  \ifthenelse{\equal{#3}{}}{}{\annVoice{#3}\skipornot}
  \ifthenelse{\equal{#4}{}}{}{\annAffected{#4}\skipornot}
  \ifthenelse{\equal{#5}{}}{}
    {{\annMessage{``#5''}}\ifthenelse{\equal{#6}{}}{\annFootnote{}}{\annFootnote{\footnote{#6}}}}
}

\newcommand{\musicalIssue}[6]{
  \item{\annType{(Musical Issue)}\skipornot
  {\annMeasure{M.#1,}}}   \ifthenelse{\equal{#2}{}}{}{\annBeat{beat #2}\skipornot}
  \ifthenelse{\equal{#3}{}}{}{\annVoice{#3}\skipornot}
  \ifthenelse{\equal{#4}{}}{}{\annAffected{#4}\skipornot}
  \ifthenelse{\equal{#5}{}}{}
    {{\annMessage{``#5''}}\ifthenelse{\equal{#6}{}}{\annFootnote{}}{\annFootnote{\footnote{#6}}}}
}

\newcommand{\lilypondIssue}[6]{
  \item{\annType{(Lilypond Issue)}\skipornot
  {\annMeasure{M.#1,}}}   \ifthenelse{\equal{#2}{}}{}{\annBeat{beat #2}\skipornot}
  \ifthenelse{\equal{#3}{}}{}{\annVoice{#3}\skipornot}
  \ifthenelse{\equal{#4}{}}{}{\annAffected{#4}\skipornot}
  \ifthenelse{\equal{#5}{}}{}
    {{\annMessage{``#5''}}\ifthenelse{\equal{#6}{}}{\annFootnote{}}{\annFootnote{\footnote{#6}}}}
}

\newcommand{\question}[6]{
  \item{\annType{(Question)}\skipornot
  {\annMeasure{M.#1,}}}   \ifthenelse{\equal{#2}{}}{}{\annBeat{beat #2}\skipornot}
  \ifthenelse{\equal{#3}{}}{}{\annVoice{#3}\skipornot}
  \ifthenelse{\equal{#4}{}}{}{\annAffected{#4}\skipornot}
  \ifthenelse{\equal{#5}{}}{}
    {{\annMessage{``#5''}}\ifthenelse{\equal{#6}{}}{\annFootnote{}}{\annFootnote{\footnote{#6}}}}
}

\newcommand{\todo}[6]{
  \item{\annType{(Todo)}\skipornot
  {\annMeasure{M.#1,}}}   \ifthenelse{\equal{#2}{}}{}{\annBeat{beat #2}\skipornot}
  \ifthenelse{\equal{#3}{}}{}{\annVoice{#3}\skipornot}
  \ifthenelse{\equal{#4}{}}{}{\annAffected{#4}\skipornot}
  \ifthenelse{\equal{#5}{}}{}
    {{\annMessage{``#5''}}\ifthenelse{\equal{#6}{}}{\annFootnote{}}{\annFootnote{\footnote{#6}}}}
}

\endinput
